<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Don't Touch The Floor!</title>
  <style>
    /* Basic reset and sizing */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
      text-align: center;
    }

    /* The container for the entire game screen */
    #appContainer {
      position: relative;
      width: 100%;
      height: 100%;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      overflow: hidden;
      background-size: cover;    /* Make background images fill the screen */
      background-position: center;
      background-repeat: no-repeat;
    }

    /* Opening title text style */
    .title {
      font-size: 3em;
      margin-bottom: 20px;
    }

    /* Mode text style (HAND MODE, KICK MODE, etc.) */
    .mode-text {
      font-size: 4em;
    }

    /* Common style for Play and End Game buttons */
    .play-button, .end-button {
      background: rgba(0,0,0,0.7);
      border: none;
      padding: 1em 2em;
      color: #fff;
      font-size: 1.2em;
      cursor: pointer;
      border-radius: 8px;
    }
    .play-button:hover, .end-button:hover {
      background: rgba(0,0,0,0.9);
    }

    /* The End Game button in the top-right corner */
    .end-button {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 1em;
      z-index: 999;
    }

    /* "GET READY!" text style */
    .get-ready-text {
      font-size: 3em;
    }
  </style>
</head>
<body>

<!-- Background music file (looped) -->
<audio id="backgroundMusic" src="your-default-background-music.mp3" loop></audio>

<div id="appContainer"></div>

<script>
  // -- GLOBALS --
  let isGameRunning = false;
  let activeTimeouts = [];
  let audioContext = null;           // For the "DING DING" beep
  let lastModeIndex = -1;            // Track the last mode index shown

  // We'll handle background music and override music
  const backgroundMusic = document.getElementById('backgroundMusic');
  let overrideMusic = null; // We'll dynamically create a new Audio() if needed

  // Define the modes with their text, color, optional image, optional override music, and custom durations
  // If backgroundImage is null or "", the code uses the plain color instead
  // If overrideMusicUrl is null or "", no special music is played for that mode
  // minDuration and maxDuration are in milliseconds
  const modes = [
    {
      name: 'HAND MODE',
      color: '#FF3333',
      backgroundImage: 'handmode.png',  // e.g. "handmode.png"
      overrideMusicUrl: '', // e.g. "https://example.com/hand-mode-music.mp3"
      minDuration: 1000,
      maxDuration: 2000
    },
    {
      name: 'KICK MODE',
      color: '#33CC33',
      backgroundImage: 'kickmode.png',  // e.g. "https://example.com/kick-mode.jpg"
      overrideMusicUrl: '',
      minDuration: 1000,
      maxDuration: 2000
    },
    {
      name: 'BAT MODE',
      color: '#3333FF',
      backgroundImage: 'batmode.png',
      overrideMusicUrl: '',
      minDuration: 1000,
      maxDuration: 2000
    },
    {
      name: 'HEAD MODE',
      color: '#FF9900',
      backgroundImage: '',  // e.g. "https://example.com/head-mode.jpg"
      overrideMusicUrl: '',
      minDuration: 1000,
      maxDuration: 2000
    },
    {
      name: 'BED MODE',
      color: '#663399',
      backgroundImage: '',
      overrideMusicUrl: '',
      minDuration: 1000,
      maxDuration: 2000
    },
    {
      name: 'ELBOW MODE',
      color: '#CC33CC',
      backgroundImage: '',
      overrideMusicUrl: '',
      minDuration: 1000,
      maxDuration: 2000
    },
    {
      name: 'NOSE MODE',
      color: '#FFA500',
      backgroundImage: '',
      overrideMusicUrl: '',
      minDuration: 1000,
      maxDuration: 2000
    }
  ];

  const appContainer = document.getElementById('appContainer');

  // -- HELPER: Clear all active timeouts --
  function clearAllTimeouts() {
    activeTimeouts.forEach(id => clearTimeout(id));
    activeTimeouts = [];
  }

  // -- HELPER: Get random duration for a particular mode
  function getModeDuration(mode) {
    const minMs = mode.minDuration;
    const maxMs = mode.maxDuration;
    return Math.floor(Math.random() * (maxMs - minMs + 1)) + minMs;
  }

  // -- HELPER: Show home screen (opening page) --
  function showHomeScreen() {
    // Stop any music if it's playing
    backgroundMusic.pause();
    backgroundMusic.currentTime = 0;
    if (overrideMusic) {
      overrideMusic.pause();
      overrideMusic = null;
    }

    appContainer.style.backgroundColor = '#FF00AA'; // Some bright color
    appContainer.style.backgroundImage = 'none';    // Remove any leftover image
    appContainer.innerHTML = `
      <div class="title">Don't Touch The Floor!</div>
      <button class="play-button" onclick="startGame()">Play</button>
    `;
  }

  // -- HELPER: Show "GET READY!" screen for 5s before a mode
  function showGetReadyScreen(callback) {
    appContainer.style.backgroundColor = '#000000';
    appContainer.style.backgroundImage = 'none'; // No image for get-ready screen
    appContainer.innerHTML = `
      <button class="end-button" onclick="endGame()">End Game</button>
      <div class="get-ready-text">GET READY!</div>
    `;
    // After 5 seconds, call the callback
    const t = setTimeout(callback, 5000);
    activeTimeouts.push(t);
  }

  // -- HELPER: Show a mode screen and hold it for random duration
  function showModeScreen() {
    if (!isGameRunning) return;

    // Pick a mode different from the last one
    let randomModeIndex;
    do {
      randomModeIndex = Math.floor(Math.random() * modes.length);
    } while (randomModeIndex === lastModeIndex && modes.length > 1);

    lastModeIndex = randomModeIndex;
    const mode = modes[randomModeIndex];

    // 1) Set the background
    if (mode.backgroundImage) {
      appContainer.style.backgroundImage = `url('${mode.backgroundImage}')`;
      appContainer.style.backgroundColor = 'transparent'; // let image show
    } else {
      appContainer.style.backgroundImage = 'none';
      appContainer.style.backgroundColor = mode.color;
    }

    // 2) Play "DING DING" beep
    playDingDing();

    // 3) If this mode has override music, pause main music, play override
    //    Otherwise, keep main music playing.
    if (mode.overrideMusicUrl) {
      // Pause background music
      backgroundMusic.pause();

      // Create an override audio if not existing
      overrideMusic = new Audio(mode.overrideMusicUrl);
      overrideMusic.play().catch(err => {
        console.warn("Could not play override music:", err);
      });
    } else {
      // Ensure we are on background music (it might have been playing already)
      // If you want it always playing, you can do .play() again or do nothing
      // in case it was never paused in this game session
      if (backgroundMusic.paused) {
        backgroundMusic.play().catch(err => {
          console.warn("Could not resume background music:", err);
        });
      }
    }

    // 4) Render mode text
    appContainer.innerHTML = `
      <button class="end-button" onclick="endGame()">End Game</button>
      <div class="mode-text">${mode.name}</div>
    `;

    // 5) Stay in this mode for a random time (unique to that mode)
    const duration = getModeDuration(mode);
    const t = setTimeout(() => {
      if (isGameRunning) {
        // If override music is playing, stop it
        if (overrideMusic && !overrideMusic.paused) {
          overrideMusic.pause();
          overrideMusic = null;
        }
        // Resume the main music after override
        if (backgroundMusic.paused) {
          backgroundMusic.play().catch(err => {
            console.warn("Could not resume background music:", err);
          });
        }
        // Move to "GET READY!" then next mode
        showGetReadyScreen(showModeScreen);
      }
    }, duration);
    activeTimeouts.push(t);
  }

  // -- MAIN CYCLE: show "GET READY!" then show the mode, repeat...
  function cycleModes() {
    showGetReadyScreen(showModeScreen);
  }

  // -- START the game --
  function startGame() {
    // Must be triggered by user action to comply with browser audio policies
    if (!audioContext) {
      audioContext = new AudioContext();
    }
    clearAllTimeouts();
    isGameRunning = true;

    // Start background music
    backgroundMusic.currentTime = 0;
    backgroundMusic.volume = 1.0;
    backgroundMusic.play().catch(err => {
      console.warn("Could not start background music:", err);
    });

    cycleModes();
  }

  // -- END the game --
  function endGame() {
    isGameRunning = false;
    clearAllTimeouts();

    // If override music is playing, stop it
    if (overrideMusic) {
      overrideMusic.pause();
      overrideMusic = null;
    }

    showHomeScreen();
  }

  // -- AUDIO: "DING DING" using the Web Audio API --
  function playDingDing() {
    if (!audioContext) return; // If somehow not initialized, skip

    const now = audioContext.currentTime;
    let beepStart = now;

    // We want two short beeps in quick succession: "DING DING"
    for (let i = 0; i < 2; i++) {
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();

      oscillator.frequency.value = 880; // A5 note
      oscillator.type = 'sine';

      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);

      oscillator.start(beepStart);
      oscillator.stop(beepStart + 0.2);

      // Each beep begins 0.3s after the previous beep start
      beepStart += 0.3;
    }
  }

  // Show the home screen immediately on load
  showHomeScreen();
</script>

</body>
</html>